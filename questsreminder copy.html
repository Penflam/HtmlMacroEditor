<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="UTF-8" />
		<title>Reminder Pantheon</title>
		<style>
			body {
				font-family: sans-serif;
				max-width: 900px;
				margin: auto;
				padding: 1em;
			}
			h1,
			h2 {
				text-align: center;
			}
			nav {
				text-align: center;
				margin-bottom: 1em;
			}
			nav a {
				margin: 0 1em;
				cursor: pointer;
				text-decoration: underline;
			}
			label {
				display: block;
				margin-top: 1em;
			}
			input,
			textarea,
			select {
				width: 100%;
				padding: 0.5em;
				margin-top: 0.2em;
			}
			button {
				margin-top: 1em;
				padding: 0.5em 1em;
			}
			.entry {
				border: 1px solid #ccc;
				padding: 1em;
				margin-top: 1em;
				border-radius: 6px;
			}
			.validated {
				background-color: #e0ffe0;
			}
			.actions {
				margin-top: 1em;
			}
			.modal {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.5);
				justify-content: center;
				align-items: center;
			}
			.modal-content {
				background: white;
				padding: 2em;
				border-radius: 8px;
				width: 100%;
				max-width: 500px;
				position: relative;
			}
			.close-button {
				position: absolute;
				top: 10px;
				right: 10px;
				cursor: pointer;
				font-size: 1.2em;
				color: #555;
			}
			.filters {
				display: flex;
				justify-content: space-between;
				align-items: center;
				flex-wrap: wrap;
				gap: 1em;
				margin-bottom: 1em;
			}
			.filters label {
				flex: 1;
				min-width: 200px;
			}
		</style>
	</head>
	<body>
		<h1>Rappel Pantheon</h1>

		<nav>
			<a onclick="showForm('qu√™te')">‚ûï Ajouter une qu√™te</a>
			<a onclick="showForm('objet')">üì¶ Ajouter un objet</a>
			<a onclick="showForm('lieu')">üó∫Ô∏è Ajouter un lieu</a>
		</nav>

		<div class="modal" id="modal">
			<div class="modal-content">
				<span class="close-button" onclick="closeModal()">&times;</span>
				<form id="entryForm">
					<label
						>Type :
						<select id="type">
							<option value="qu√™te">Qu√™te</option>
							<option value="objet">Objet</option>
							<option value="lieu">Lieu</option>
						</select>
					</label>
					<label>Titre : <input type="text" id="titre" required /></label>
					<label
						>Description : <textarea id="description"></textarea>
					</label>
					<label>Lien (optionnel) : <input type="url" id="lien" /></label>
					<input type="hidden" id="entryId" />
					<button type="submit">Enregistrer</button>
				</form>
			</div>
		</div>

		<h2>Filtres</h2>
		<div class="filters">
			<label
				>üéØ Type :
				<select id="filterType">
					<option value="">Tous</option>
					<option value="qu√™te">Qu√™te</option>
					<option value="objet">Objet</option>
					<option value="lieu">Lieu</option>
				</select>
			</label>
			<label
				>üìÖ Date :
				<input type="date" id="filterDate" />
			</label>
			<label
				>üîÉ Ordre :
				<select id="sortOrder">
					<option value="desc">Du plus r√©cent au plus ancien</option>
					<option value="asc">Du plus ancien au plus r√©cent</option>
				</select>
			</label>
			<label
				>üîç Recherche :
				<input type="text" id="filterText" placeholder="Rechercher..." />
			</label>
		</div>

		<div id="entries"></div>

		<script>
			const modal = document.getElementById("modal");
			const form = document.getElementById("entryForm");
			const entriesDiv = document.getElementById("entries");
			const filterType = document.getElementById("filterType");
			const filterDate = document.getElementById("filterDate");
			const sortOrder = document.getElementById("sortOrder");
			const filterText = document.getElementById("filterText");

			let entries = JSON.parse(
				localStorage.getItem("pantheonEntries") || "[]"
			);

			function save() {
				localStorage.setItem("pantheonEntries", JSON.stringify(entries));
				render();
			}

			function render() {
				const typeFilter = filterType.value.toLowerCase();
				const dateFilter = filterDate.value;
				const textFilter = filterText.value.toLowerCase();
				const order = sortOrder.value;

				entriesDiv.innerHTML = "";

				let filtered = entries.filter((e) => {
					const matchesType = !typeFilter || e.type === typeFilter;
					const matchesDate =
						!dateFilter || e.dateAjout.startsWith(dateFilter);
					const matchesText =
						!textFilter ||
						e.type.toLowerCase().includes(textFilter) ||
						e.titre.toLowerCase().includes(textFilter) ||
						e.description.toLowerCase().includes(textFilter) ||
						(e.lien && e.lien.toLowerCase().includes(textFilter));
					return matchesType && matchesDate && matchesText;
				});

				filtered.sort((a, b) =>
					order === "asc"
						? new Date(a.dateAjout) - new Date(b.dateAjout)
						: new Date(b.dateAjout) - new Date(a.dateAjout)
				);

				filtered.forEach((entry) => {
					const div = document.createElement("div");
					div.className = "entry" + (entry.valide ? " validated" : "");
					div.innerHTML = `
          <strong>[${entry.type.toUpperCase()}]</strong> <b>${
						entry.titre
					}</b><br>
          <small>Ajout√© le ${new Date(
					entry.dateAjout
				).toLocaleDateString()}</small><br>
          <p>${entry.description}</p>
          ${
					entry.lien
						? `<a href="${entry.lien}" target="_blank">Lien utile</a><br>`
						: ""
				}
          <div class="actions">
            <button onclick="toggleValid(${entry.id})">${
						entry.valide ? "Marquer non valid√©" : "Valider"
					}</button>
            <button onclick="editEntry(${entry.id})">Modifier</button>
            <button onclick="deleteEntry(${entry.id})">Supprimer</button>
          </div>
        `;
					entriesDiv.appendChild(div);
				});
			}

			form.onsubmit = (e) => {
				e.preventDefault();
				const id = document.getElementById("entryId").value;
				const newEntry = {
					id: id ? parseInt(id) : Date.now(),
					type: document.getElementById("type").value,
					titre: document.getElementById("titre").value,
					description: document.getElementById("description").value,
					lien: document.getElementById("lien").value,
					dateAjout: new Date().toISOString(),
					valide: false,
				};

				if (id) {
					entries = entries.map((e) =>
						e.id === newEntry.id ? newEntry : e
					);
				} else {
					entries.push(newEntry);
				}

				form.reset();
				closeModal();
				document.getElementById("entryId").value = "";
				save();
			};

			function toggleValid(id) {
				const entry = entries.find((e) => e.id === id);
				if (entry) {
					entry.valide = !entry.valide;
					save();
				}
			}

			function editEntry(id) {
				const entry = entries.find((e) => e.id === id);
				if (entry) {
					document.getElementById("entryId").value = entry.id;
					document.getElementById("type").value = entry.type;
					document.getElementById("titre").value = entry.titre;
					document.getElementById("description").value = entry.description;
					document.getElementById("lien").value = entry.lien;
					openModal();
				}
			}

			function deleteEntry(id) {
				if (confirm("Supprimer cette entr√©e ?")) {
					entries = entries.filter((e) => e.id !== id);
					save();
				}
			}

			function showForm(type) {
				document.getElementById("entryId").value = "";
				document.getElementById("type").value = type;
				document.getElementById("titre").value = "";
				document.getElementById("description").value = "";
				document.getElementById("lien").value = "";
				openModal();
			}

			function openModal() {
				modal.style.display = "flex";
			}

			function closeModal() {
				modal.style.display = "none";
			}

			filterType.onchange = render;
			filterDate.onchange = render;
			sortOrder.onchange = render;
			filterText.oninput = render;

			render();
		</script>
	</body>
</html>
